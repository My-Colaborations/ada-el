#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# gnatmake can do parallel builds; we don't want make to interfere.
.NOTPARALLEL:

ALIVERSION := $(shell sed -n -r 's/^Package: libada-el(.*)-dev$$/\1/p' debian/control)
SOVERSION := $(shell sed -n -r 's/^Package: libada-el([^-]+)$$/\1/p' debian/control)
CPUS := $(shell getconf _NPROCESSORS_ONLN)
DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
package=libada-el-dev

LIBRARY_TYPE=dynamic

%:
	dh $@ 

override_dh_auto_configure:
	dh_auto_configure -- --enable-shared

override_dh_auto_build:
	dh_auto_build

override_dh_auto_install:
	$(MAKE) prefix=$(CURDIR)/debian/tmp/usr install
	$(MAKE) prefix=$(CURDIR)/debian/tmp/usr docdir=$(package) install_samples
	dh_installdirs -p$(package) usr/share/doc/$(package)/samples
	dh_install -p$(package) samples/*.ads usr/share/doc/$(package)/samples
	dh_install -p$(package) samples/*.adb usr/share/doc/$(package)/samples
	dh_install -p$(package) samples.gpr usr/share/doc/$(package)/
	dh_install -p$(package) config.gpr usr/share/doc/$(package)/
	sed -e "s,INSTALL,/usr,g" -e "s,LIBRARY_TYPE,$(LIBRARY_TYPE),g" \
		< $(CURDIR)/distrib/el.gpr > $(CURDIR)/debian/tmp/usr/share/ada/adainclude/el.gpr

override_dh_strip:
	dh_strip --dbg-package=libada-el-dbg

